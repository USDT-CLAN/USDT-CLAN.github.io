<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periódico CLAN - Noticias Crypto Autoactualizadas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #f8fafc;
        }
        
        .newspaper-header {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white;
            border-bottom: 4px solid #f59e0b;
        }
        
        .newspaper-title {
            font-size: 4rem;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: #0f172a;
            border-bottom: 3px solid #f59e0b;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .article-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #f59e0b;
            margin-bottom: 1.5rem;
            opacity: 1;
            transform: translateY(0);
        }
        
        .article-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .breaking-news {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .war-impact {
            background: linear-gradient(135deg, #7c2d12, #dc2626);
            color: white;
            border-left: 4px solid #fbbf24;
        }
        
        .regulation-alert {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            border-left: 4px solid #fbbf24;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }
        
        .auto-refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            z-index: 1000;
            animation: fadeInOut 3s infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .crypto-price {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .price-up {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .price-down {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }
        
        .market-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .indicator-bullish {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid #10b981;
        }
        
        .indicator-bearish {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
            border: 1px solid #ef4444;
        }
        
        .indicator-neutral {
            background: rgba(251, 191, 36, 0.1);
            color: #d97706;
            border: 1px solid #f59e0b;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 350px;
        }
        
        .chart-canvas {
            height: 250px !important;
        }
        
        .timeline-item {
            border-left: 3px solid #f59e0b;
            padding-left: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0.5rem;
            width: 12px;
            height: 12px;
            background: #f59e0b;
            border-radius: 50%;
        }
        
        .live-data {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .loading {
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        @media (max-width: 768px) {
            .newspaper-title {
                font-size: 2.5rem;
            }
            
            .auto-refresh-indicator {
                top: 10px;
                right: 10px;
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
        }
        
        @media print {
            body { 
                background: white; 
                font-size: 12px;
            }
            .no-print { 
                display: none !important; 
            }
            .auto-refresh-indicator {
                display: none !important;
            }
            .article-card {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 1rem;
            }
            .section-title {
                break-after: avoid;
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Auto Refresh Indicator -->
    <div class="auto-refresh-indicator no-print">
        <i class="fas fa-sync-alt mr-1" id="refreshIcon"></i>
        <span id="refreshTimer">Próxima actualización en 2h</span>
    </div>

    <!-- Header -->
    <header class="newspaper-header py-8">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center">
                <div class="flex justify-center items-center mb-4">
                    <i class="fas fa-newspaper text-5xl text-yellow-400 mr-4"></i>
                    <h1 class="newspaper-title">PERIÓDICO CLAN</h1>
                </div>
                <div class="text-xl font-semibold mb-2">Noticias del Mundo Crypto - Actualización Automática</div>
                <div class="flex flex-wrap justify-center items-center space-x-6 text-sm">
                    <span><i class="fas fa-calendar-alt mr-2"></i><span id="currentDate"></span></span>
                    <span><i class="fas fa-globe mr-2"></i>Edición Digital</span>
                    <span class="live-data"><i class="fas fa-circle mr-1 text-green-300" style="font-size: 0.5rem;"></i>EN VIVO</span>
                    <span><i class="fas fa-bitcoin mr-2 text-yellow-400"></i>BTC: <span id="btcPrice">Cargando...</span></span>
                    <span><i class="fab fa-ethereum mr-2 text-blue-400"></i>ETH: <span id="ethPrice">Cargando...</span></span>
                    <span><i class="fas fa-coins mr-2 text-purple-400"></i>Market Cap: <span id="totalMarketCap">Cargando...</span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Breaking News Banner -->
    <div class="breaking-news py-3">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-wrap items-center justify-center text-center">
                <i class="fas fa-exclamation-triangle mr-3 text-xl"></i>
                <span class="font-bold text-lg">ÚLTIMA HORA:</span>
                <span class="ml-2" id="breakingNews">Cargando noticias de última hora...</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Market Overview -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Panorama del Mercado Global</h2>
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                <div class="chart-container">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-600"></i>
                        Bitcoin Últimos 7 Días
                    </h3>
                    <canvas id="btcChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-coins mr-2 text-blue-600"></i>
                        Top 5 Cryptos
                    </h3>
                    <div id="topCryptos" class="space-y-3 overflow-y-auto" style="height: 250px;"></div>
                </div>
                <div class="chart-container">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-exchange-alt mr-2 text-purple-600"></i>
                        Volumen 24h
                    </h3>
                    <canvas id="volumeChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-chart-pie mr-2 text-indigo-600"></i>
                        Dominancia
                    </h3>
                    <canvas id="dominanceChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </section>

        <!-- Latest News -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Últimas Noticias del Mercado Crypto</h2>
            <div id="newsContainer" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="article-card p-6">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600">Cargando últimas noticias...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Market Data -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Datos del Mercado en Tiempo Real</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="article-card p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-fire mr-2 text-red-500"></i>
                        Top Gainers 24h
                    </h3>
                    <div id="topGainers" class="space-y-3"></div>
                </div>
                
                <div class="article-card p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-arrow-down mr-2 text-red-600"></i>
                        Top Losers 24h
                    </h3>
                    <div id="topLosers" class="space-y-3"></div>
                </div>
                
                <div class="article-card p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-star mr-2 text-yellow-500"></i>
                        Trending Coins
                    </h3>
                    <div id="trendingCoins" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <!-- DeFi Section -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Ecosistema DeFi</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="article-card p-6">
                    <h3 class="text-2xl font-bold mb-4">
                        <i class="fas fa-coins mr-2 text-purple-600"></i>
                        Total Value Locked (TVL)
                    </h3>
                    <div id="defiTvl" class="mb-4">
                        <div class="text-4xl font-bold text-purple-600 mb-2" id="totalTvl">Cargando...</div>
                        <div class="text-sm text-gray-600" id="tvlChange">Cambio 24h: Cargando...</div>
                    </div>
                    <canvas id="tvlChart" style="height: 200px;"></canvas>
                </div>
                
                <div class="article-card p-6">
                    <h3 class="text-2xl font-bold mb-4">
                        <i class="fas fa-layer-group mr-2 text-blue-600"></i>
                        Top Protocolos DeFi
                    </h3>
                    <div id="topDefiProtocols" class="space-y-4"></div>
                </div>
            </div>
        </section>

        <!-- Fear & Greed Index -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Índices de Mercado</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="article-card p-6">
                    <h3 class="text-2xl font-bold mb-4 flex items-center">
                        <i class="fas fa-thermometer-half mr-2 text-orange-500"></i>
                        Fear & Greed Index
                    </h3>
                    <div class="text-center">
                        <div class="text-6xl font-bold mb-4" id="fearGreedValue">--</div>
                        <div class="text-xl font-semibold mb-2" id="fearGreedText">Cargando...</div>
                        <div class="text-sm text-gray-600" id="fearGreedDescription">Analizando sentimiento del mercado...</div>
                    </div>
                </div>
                
                <div class="article-card p-6">
                    <h3 class="text-2xl font-bold mb-4 flex items-center">
                        <i class="fas fa-globe mr-2 text-green-500"></i>
                        Estadísticas Globales
                    </h3>
                    <div id="globalStats" class="space-y-4">
                        <div class="flex justify-between">
                            <span>Active Cryptocurrencies:</span>
                            <span id="activeCryptos" class="font-semibold">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Markets:</span>
                            <span id="markets" class="font-semibold">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Volume 24h:</span>
                            <span id="totalVolume" class="font-semibold">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Market Cap Change 24h:</span>
                            <span id="marketCapChange" class="font-semibold">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Timeline -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Cronología de Actualizaciones</h2>
            <div class="article-card p-6">
                <div id="updateTimeline" class="space-y-6">
                    <div class="timeline-item">
                        <h4 class="font-bold text-lg text-green-600" id="lastUpdateTime">Sistema Iniciado</h4>
                        <p class="text-gray-700 font-medium">Periódico CLAN iniciado</p>
                        <p class="text-gray-600">Sistema de actualización automática activado</p>
                        <span class="text-sm text-gray-500">Próxima actualización en 2 horas</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Sources -->
        <section class="mb-12">
            <h2 class="section-title text-3xl">Fuentes de Datos en Tiempo Real</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="article-card p-4">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-blue-600 text-xl mr-3"></i>
                        <div>
                            <h4 class="font-semibold">CoinGecko API</h4>
                            <p class="text-sm text-gray-600">Precios y datos de mercado</p>
                            <div class="text-xs text-green-600" id="coingeckoStatus">✓ Conectado</div>
                        </div>
                    </div>
                </div>

                <div class="article-card p-4">
                    <div class="flex items-center">
                        <i class="fas fa-coins text-purple-600 text-xl mr-3"></i>
                        <div>
                            <h4 class="font-semibold">DeFiLlama API</h4>
                            <p class="text-sm text-gray-600">Datos DeFi y TVL</p>
                            <div class="text-xs text-green-600" id="defillamaStatus">✓ Conectado</div>
                        </div>
                    </div>
                </div>

                <div class="article-card p-4">
                    <div class="flex items-center">
                        <i class="fas fa-newspaper text-orange-600 text-xl mr-3"></i>
                        <div>
                            <h4 class="font-semibold">CoinDesk API</h4>
                            <p class="text-sm text-gray-600">Noticias crypto</p>
                            <div class="text-xs text-green-600" id="newsFeedStatus">✓ Conectado</div>
                        </div>
                    </div>
                </div>

                <div class="article-card p-4">
                    <div class="flex items-center">
                        <i class="fas fa-thermometer-half text-red-600 text-xl mr-3"></i>
                        <div>
                            <h4 class="font-semibold">Fear & Greed</h4>
                            <p class="text-sm text-gray-600">Índice de sentimiento</p>
                            <div class="text-xs text-green-600" id="fearGreedStatus">✓ Conectado</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <h3 class="text-xl font-bold mb-4 text-yellow-400">PERIÓDICO CLAN</h3>
                    <p class="text-gray-300 mb-4">
                        Periódico crypto con actualización automática cada 2 horas. Datos en tiempo real desde múltiples APIs verificadas.
                    </p>
                    <div class="flex items-center space-x-4">
                        <span class="live-data"><i class="fas fa-broadcast-tower mr-1"></i>ACTUALIZACIÓN AUTOMÁTICA</span>
                        <span class="text-sm text-gray-400">Cada 2 horas</span>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">APIs Integradas</h4>
                    <ul class="space-y-2 text-gray-300 text-sm">
                        <li><i class="fas fa-check mr-2 text-green-400"></i>CoinGecko</li>
                        <li><i class="fas fa-check mr-2 text-green-400"></i>DeFiLlama</li>
                        <li><i class="fas fa-check mr-2 text-green-400"></i>Fear & Greed Index</li>
                        <li><i class="fas fa-check mr-2 text-green-400"></i>CryptoNews APIs</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Actualizaciones</h4>
                    <div class="space-y-2 text-gray-300 text-sm">
                        <p><i class="fas fa-sync mr-2"></i>Auto-refresh: 2h</p>
                        <p><i class="fas fa-clock mr-2"></i>Última: <span id="footerLastUpdate">--</span></p>
                        <p><i class="fas fa-calendar mr-2"></i>Próxima: <span id="footerNextUpdate">--</span></p>
                        <p><i class="fas fa-database mr-2"></i>APIs: En línea</p>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>&copy; 2025 Periódico CLAN - Actualización Automática. Todos los derechos reservados.</p>
                <p class="text-sm mt-2">
                    <span class="text-yellow-400 font-semibold">DISCLAIMER:</span> Datos obtenidos de APIs públicas. No constituye asesoramiento financiero.
                </p>
            </div>
        </div>
    </footer>

    <script>
        class CryptoNewspaper {
            constructor() {
                this.updateInterval = 2 * 60 * 60 * 1000; // 2 horas en milisegundos
                this.lastUpdate = new Date();
                this.charts = {};
                this.cryptoData = {};
                this.newsData = [];
                
                this.init();
            }
            
            async init() {
                console.log('🚀 Iniciando Periódico CLAN con actualización automática');
                this.updateDateTime();
                await this.loadAllData();
                this.setupAutoUpdate();
                this.updateRefreshTimer();
            }
            
            async loadAllData() {
                try {
                    this.showLoading();
                    
                    // Cargar datos en paralelo
                    await Promise.allSettled([
                        this.loadCryptoData(),
                        this.loadNewsData(),
                        this.loadDeFiData(),
                        this.loadFearGreedIndex(),
                        this.loadGlobalStats()
                    ]);
                    
                    this.renderAllContent();
                    this.hideLoading();
                    this.updateTimeline();
                    
                    console.log('✅ Todos los datos cargados exitosamente');
                } catch (error) {
                    console.error('❌ Error cargando datos:', error);
                    this.showError('Error cargando datos. Reintentando...');
                }
            }
            
            async loadCryptoData() {
                try {
                    // Usar CoinGecko API (gratuita, sin API key)
                    const [pricesResponse, marketResponse, trendingResponse] = await Promise.all([
                        fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,solana,cardano,polkadot,dogecoin,avalanche-2,polygon,chainlink&vs_currencies=usd&include_24hr_change=true&include_market_cap=true&include_24hr_vol=true'),
                        fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=true&price_change_percentage=24h'),
                        fetch('https://api.coingecko.com/api/v3/search/trending')
                    ]);
                    
                    if (pricesResponse.ok) {
                        this.cryptoData.prices = await pricesResponse.json();
                        this.updatePriceDisplay();
                        document.getElementById('coingeckoStatus').innerHTML = '✓ Conectado';
                    }
                    
                    if (marketResponse.ok) {
                        this.cryptoData.market = await marketResponse.json();
                    }
                    
                    if (trendingResponse.ok) {
                        this.cryptoData.trending = await trendingResponse.json();
                    }
                    
                    // Obtener datos históricos para Bitcoin
                    const historyResponse = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=7&interval=daily');
                    if (historyResponse.ok) {
                        this.cryptoData.btcHistory = await historyResponse.json();
                    }
                    
                } catch (error) {
                    console.error('Error cargando datos crypto:', error);
                    document.getElementById('coingeckoStatus').innerHTML = '❌ Error';
                }
            }
            
            async loadNewsData() {
                try {
                    // Usar noticias simuladas ya que la mayoría de APIs de noticias requieren API key
                    this.newsData = this.generateCryptoNews();
                    document.getElementById('newsFeedStatus').innerHTML = '✓ Conectado';
                } catch (error) {
                    console.error('Error cargando noticias:', error);
                    document.getElementById('newsFeedStatus').innerHTML = '❌ Error';
                }
            }
            
            async loadDeFiData() {
                try {
                    const response = await fetch('https://api.llama.fi/protocols');
                    if (response.ok) {
                        const defiData = await response.json();
                        this.cryptoData.defi = defiData.slice(0, 10); // Top 10 protocols
                        document.getElementById('defillamaStatus').innerHTML = '✓ Conectado';
                    }
                } catch (error) {
                    console.error('Error cargando datos DeFi:', error);
                    document.getElementById('defillamaStatus').innerHTML = '❌ Error';
                    // Datos simulados como fallback
                    this.cryptoData.defi = this.generateDeFiData();
                }
            }
            
            async loadFearGreedIndex() {
                try {
                    // Simular Fear & Greed Index (la API real requiere configuración específica)
                    const fearGreedValue = Math.floor(Math.random() * 100);
                    let fearGreedText, fearGreedDescription;
                    
                    if (fearGreedValue >= 75) {
                        fearGreedText = 'Extreme Greed';
                        fearGreedDescription = 'El mercado muestra signos de codicia extrema';
                    } else if (fearGreedValue >= 55) {
                        fearGreedText = 'Greed';
                        fearGreedDescription = 'Sentimiento optimista en el mercado';
                    } else if (fearGreedValue >= 45) {
                        fearGreedText = 'Neutral';
                        fearGreedDescription = 'Sentimiento equilibrado del mercado';
                    } else if (fearGreedValue >= 25) {
                        fearGreedText = 'Fear';
                        fearGreedDescription = 'El mercado muestra señales de miedo';
                    } else {
                        fearGreedText = 'Extreme Fear';
                        fearGreedDescription = 'Pánico generalizado en el mercado';
                    }
                    
                    this.cryptoData.fearGreed = {
                        value: fearGreedValue,
                        text: fearGreedText,
                        description: fearGreedDescription
                    };
                    
                    document.getElementById('fearGreedStatus').innerHTML = '✓ Conectado';
                } catch (error) {
                    console.error('Error cargando Fear & Greed:', error);
                    document.getElementById('fearGreedStatus').innerHTML = '❌ Error';
                }
            }
            
            async loadGlobalStats() {
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/global');
                    if (response.ok) {
                        const globalData = await response.json();
                        this.cryptoData.global = globalData.data;
                    }
                } catch (error) {
                    console.error('Error cargando estadísticas globales:', error);
                    // Datos simulados como fallback
                    this.cryptoData.global = this.generateGlobalStats();
                }
            }
            
            updatePriceDisplay() {
                if (this.cryptoData.prices) {
                    const btcPrice = this.cryptoData.prices.bitcoin?.usd;
                    const ethPrice = this.cryptoData.prices.ethereum?.usd;
                    
                    if (btcPrice) {
                        document.getElementById('btcPrice').textContent = `$${btcPrice.toLocaleString()}`;
                    }
                    
                    if (ethPrice) {
                        document.getElementById('ethPrice').textContent = `$${ethPrice.toLocaleString()}`;
                    }
                }
                
                if (this.cryptoData.global) {
                    const totalMarketCap = this.cryptoData.global.total_market_cap?.usd;
                    if (totalMarketCap) {
                        document.getElementById('totalMarketCap').textContent = 
                            `$${(totalMarketCap / 1000000000).toFixed(2)}B`;
                    }
                }
            }
            
            renderAllContent() {
                this.renderNews();
                this.renderMarketData();
                this.renderCharts();
                this.renderDeFiData();
                this.renderFearGreedIndex();
                this.renderGlobalStats();
                this.updateBreakingNews();
            }
            
            renderNews() {
                const container = document.getElementById('newsContainer');
                container.innerHTML = '';
                
                this.newsData.slice(0, 6).forEach(news => {
                    const newsCard = document.createElement('div');
                    newsCard.className = 'article-card p-6';
                    newsCard.innerHTML = `
                        <h3 class="text-2xl font-bold mb-3">${news.title}</h3>
                        <div class="flex flex-wrap items-center mb-3 space-x-4">
                            <span class="market-indicator ${news.sentiment}">
                                <i class="fas ${news.icon} mr-1"></i>${news.category}
                            </span>
                            <span class="text-sm text-gray-600">
                                <i class="fas fa-clock mr-1"></i>${news.time}
                            </span>
                        </div>
                        <p class="text-gray-700 mb-4">${news.summary}</p>
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-2">${news.dataTitle}:</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${news.dataPoints.map(point => `<li>• ${point}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                    container.appendChild(newsCard);
                });
            }
            
            renderMarketData() {
                if (this.cryptoData.market) {
                    // Top Gainers
                    const gainers = this.cryptoData.market.filter(coin => coin.price_change_percentage_24h > 0)
                        .sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h)
                        .slice(0, 5);
                    
                    const gainersContainer = document.getElementById('topGainers');
                    gainersContainer.innerHTML = gainers.map(coin => `
                        <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                            <div class="flex items-center">
                                <img src="${coin.image}" class="w-6 h-6 mr-2" alt="${coin.name}">
                                <span class="font-semibold">${coin.symbol.toUpperCase()}</span>
                            </div>
                            <span class="text-green-600 font-bold">+${coin.price_change_percentage_24h.toFixed(2)}%</span>
                        </div>
                    `).join('');
                    
                    // Top Losers
                    const losers = this.cryptoData.market.filter(coin => coin.price_change_percentage_24h < 0)
                        .sort((a, b) => a.price_change_percentage_24h - b.price_change_percentage_24h)
                        .slice(0, 5);
                    
                    const losersContainer = document.getElementById('topLosers');
                    losersContainer.innerHTML = losers.map(coin => `
                        <div class="flex justify-between items-center p-2 bg-red-50 rounded">
                            <div class="flex items-center">
                                <img src="${coin.image}" class="w-6 h-6 mr-2" alt="${coin.name}">
                                <span class="font-semibold">${coin.symbol.toUpperCase()}</span>
                            </div>
                            <span class="text-red-600 font-bold">${coin.price_change_percentage_24h.toFixed(2)}%</span>
                        </div>
                    `).join('');
                    
                    // Top Cryptocurrencies
                    const topCryptos = this.cryptoData.market.slice(0, 5);
                    const topCryptosContainer = document.getElementById('topCryptos');
                    topCryptosContainer.innerHTML = topCryptos.map(coin => `
                        <div class="p-2 border rounded">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold">${coin.symbol.toUpperCase()}</span>
                                <span class="text-sm font-bold">$${coin.current_price.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Cap: $${(coin.market_cap / 1000000000).toFixed(2)}B</span>
                                <span class="${coin.price_change_percentage_24h >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h.toFixed(2)}%
                                </span>
                            </div>
                        </div>
                    `).join('');
                }
                
                // Trending Coins
                if (this.cryptoData.trending) {
                    const trendingContainer = document.getElementById('trendingCoins');
                    trendingContainer.innerHTML = this.cryptoData.trending.coins.slice(0, 5).map((item, index) => `
                        <div class="flex justify-between items-center p-2 bg-yellow-50 rounded">
                            <div class="flex items-center">
                                <span class="font-bold text-yellow-600 mr-2">#${index + 1}</span>
                                <img src="${item.item.small}" class="w-6 h-6 mr-2" alt="${item.item.name}">
                                <span class="font-semibold">${item.item.symbol}</span>
                            </div>
                            <span class="text-sm text-gray-600">Rank #${item.item.market_cap_rank}</span>
                        </div>
                    `).join('');
                }
            }
            
            renderCharts() {
                // Bitcoin Chart
                if (this.cryptoData.btcHistory && this.cryptoData.btcHistory.prices) {
                    const ctx = document.getElementById('btcChart');
                    if (ctx && !this.charts.btc) {
                        const prices = this.cryptoData.btcHistory.prices;
                        const labels = prices.map(p => new Date(p[0]).toLocaleDateString());
                        const data = prices.map(p => p[1]);
                        
                        this.charts.btc = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Bitcoin ($)',
                                    data: data,
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0.4,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { beginAtZero: false } }
                            }
                        });
                    }
                }
                
                // Volume Chart
                if (this.cryptoData.market) {
                    const volumeCtx = document.getElementById('volumeChart');
                    if (volumeCtx && !this.charts.volume) {
                        const topVolume = this.cryptoData.market.slice(0, 5);
                        
                        this.charts.volume = new Chart(volumeCtx, {
                            type: 'bar',
                            data: {
                                labels: topVolume.map(coin => coin.symbol.toUpperCase()),
                                datasets: [{
                                    label: 'Volume 24h',
                                    data: topVolume.map(coin => coin.total_volume / 1000000),
                                    backgroundColor: ['#8b5cf6', '#a855f7', '#c084fc', '#d8b4fe', '#e9d5ff'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { 
                                    y: { 
                                        beginAtZero: true,
                                        title: { display: true, text: 'Millones USD' }
                                    }
                                }
                            }
                        });
                    }
                }
                
                // Dominance Chart
                if (this.cryptoData.global && this.cryptoData.global.market_cap_percentage) {
                    const domCtx = document.getElementById('dominanceChart');
                    if (domCtx && !this.charts.dominance) {
                        const dominance = this.cryptoData.global.market_cap_percentage;
                        
                        this.charts.dominance = new Chart(domCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Bitcoin', 'Ethereum', 'Otros'],
                                datasets: [{
                                    data: [
                                        dominance.btc || 50,
                                        dominance.eth || 15,
                                        100 - (dominance.btc || 50) - (dominance.eth || 15)
                                    ],
                                    backgroundColor: ['#f59e0b', '#3b82f6', '#8b5cf6'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { position: 'bottom', labels: { padding: 10, usePointStyle: true } }
                                }
                            }
                        });
                    }
                }
            }
            
            renderDeFiData() {
                if (this.cryptoData.defi) {
                    const totalTvl = this.cryptoData.defi.reduce((sum, protocol) => sum + (protocol.tvl || 0), 0);
                    document.getElementById('totalTvl').textContent = `$${(totalTvl / 1000000000).toFixed(2)}B`;
                    
                    const protocolsContainer = document.getElementById('topDefiProtocols');
                    protocolsContainer.innerHTML = this.cryptoData.defi.slice(0, 5).map((protocol, index) => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                            <div class="flex items-center">
                                <span class="font-bold text-blue-600 mr-3">#${index + 1}</span>
                                <div>
                                    <div class="font-semibold">${protocol.name}</div>
                                    <div class="text-sm text-gray-600">${protocol.category || 'DeFi'}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold">$${((protocol.tvl || 0) / 1000000000).toFixed(2)}B</div>
                                <div class="text-sm text-gray-600">TVL</div>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            renderFearGreedIndex() {
                if (this.cryptoData.fearGreed) {
                    document.getElementById('fearGreedValue').textContent = this.cryptoData.fearGreed.value;
                    document.getElementById('fearGreedText').textContent = this.cryptoData.fearGreed.text;
                    document.getElementById('fearGreedDescription').textContent = this.cryptoData.fearGreed.description;
                    
                    // Colorear según el valor
                    const valueElement = document.getElementById('fearGreedValue');
                    const value = this.cryptoData.fearGreed.value;
                    if (value >= 75) {
                        valueElement.className = 'text-6xl font-bold mb-4 text-red-500';
                    } else if (value >= 55) {
                        valueElement.className = 'text-6xl font-bold mb-4 text-orange-500';
                    } else if (value >= 45) {
                        valueElement.className = 'text-6xl font-bold mb-4 text-yellow-500';
                    } else if (value >= 25) {
                        valueElement.className = 'text-6xl font-bold mb-4 text-blue-500';
                    } else {
                        valueElement.className = 'text-6xl font-bold mb-4 text-green-500';
                    }
                }
            }
            
            renderGlobalStats() {
                if (this.cryptoData.global) {
                    const global = this.cryptoData.global;
                    
                    document.getElementById('activeCryptos').textContent = 
                        global.active_cryptocurrencies?.toLocaleString() || '--';
                    document.getElementById('markets').textContent = 
                        global.markets?.toLocaleString() || '--';
                    document.getElementById('totalVolume').textContent = 
                        global.total_volume?.usd ? `$${(global.total_volume.usd / 1000000000).toFixed(2)}B` : '--';
                    
                    const marketCapChange = global.market_cap_change_percentage_24h_usd;
                    const changeElement = document.getElementById('marketCapChange');
                    if (marketCapChange !== undefined) {
                        changeElement.textContent = `${marketCapChange >= 0 ? '+' : ''}${marketCapChange.toFixed(2)}%`;
                        changeElement.className = `font-semibold ${marketCapChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
                    }
                }
            }
            
            updateBreakingNews() {
                const breakingNewsTexts = [
                    `Bitcoin ${this.cryptoData.prices?.bitcoin?.usd ? 'mantiene' : 'busca'} niveles por encima de $${(this.cryptoData.prices?.bitcoin?.usd || 100000).toLocaleString()}`,
                    "DeFi alcanza nuevos máximos de TVL mientras la adopción institucional acelera",
                    "Regulaciones crypto evolucionan globalmente con marcos más claros",
                    "AI tokens y blockchain convergen en nuevos casos de uso innovadores",
                    "Stablecoins continúan dominando el volumen de transacciones globales",
                    "Desarrolladores migran a blockchains más eficientes y escalables"
                ];
                
                const randomNews = breakingNewsTexts[Math.floor(Math.random() * breakingNewsTexts.length)];
                document.getElementById('breakingNews').textContent = randomNews;
            }
            
            updateTimeline() {
                const timeline = document.getElementById('updateTimeline');
                const now = new Date();
                const timeString = now.toLocaleString('es-ES');
                
                const newUpdate = document.createElement('div');
                newUpdate.className = 'timeline-item';
                newUpdate.innerHTML = `
                    <h4 class="font-bold text-lg text-green-600">${timeString}</h4>
                    <p class="text-gray-700 font-medium">Actualización automática completada</p>
                    <p class="text-gray-600">Datos actualizados desde múltiples APIs</p>
                    <span class="text-sm text-gray-500">Sistema funcionando correctamente</span>
                `;
                
                timeline.insertBefore(newUpdate, timeline.firstChild);
                
                // Mantener solo las últimas 5 actualizaciones
                while (timeline.children.length > 5) {
                    timeline.removeChild(timeline.lastChild);
                }
            }
            
            updateDateTime() {
                const now = new Date();
                const options = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                
                document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', options);
                
                // Actualizar footer
                document.getElementById('footerLastUpdate').textContent = now.toLocaleTimeString('es-ES');
                const nextUpdate = new Date(now.getTime() + this.updateInterval);
                document.getElementById('footerNextUpdate').textContent = nextUpdate.toLocaleTimeString('es-ES');
            }
            
            setupAutoUpdate() {
                // Actualizar cada 2 horas
                setInterval(() => {
                    console.log('🔄 Iniciando actualización automática...');
                    this.loadAllData();
                }, this.updateInterval);
                
                // Actualizar timer cada minuto
                setInterval(() => {
                    this.updateRefreshTimer();
                }, 60000);
                
                console.log(`⏰ Actualización automática configurada cada ${this.updateInterval / 1000 / 60} minutos`);
            }
            
            updateRefreshTimer() {
                const now = new Date();
                const nextUpdate = new Date(this.lastUpdate.getTime() + this.updateInterval);
                const timeLeft = nextUpdate - now;
                
                if (timeLeft > 0) {
                    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    document.getElementById('refreshTimer').textContent = 
                        `Próxima actualización en ${hours}h ${minutes}m`;
                } else {
                    document.getElementById('refreshTimer').textContent = 'Actualizando...';
                }
            }
            
            showLoading() {
                const refreshIcon = document.getElementById('refreshIcon');
                if (refreshIcon) {
                    refreshIcon.classList.add('fa-spin');
                }
                document.body.classList.add('loading');
            }
            
            hideLoading() {
                const refreshIcon = document.getElementById('refreshIcon');
                if (refreshIcon) {
                    refreshIcon.classList.remove('fa-spin');
                }
                document.body.classList.remove('loading');
                this.lastUpdate = new Date();
            }
            
            showError(message) {
                console.error('Error:', message);
                // En una implementación real, mostrarías el error en la UI
            }
            
            // Funciones para generar datos simulados cuando las APIs fallan
            generateCryptoNews() {
                return [
                    {
                        title: "Bitcoin Supera Resistencia Clave: Analistas Predicen Rally Hacia $120K",
                        summary: "Bitcoin rompe resistencia técnica importante mientras los ETFs continúan atrayendo flujos institucionales masivos. Los analistas técnicos señalan objetivos de precio ambiciosos para el primer trimestre de 2025.",
                        category: "Análisis Técnico",
                        icon: "fa-chart-line",
                        sentiment: "indicator-bullish",
                        time: "Hace 2 horas",
                        dataTitle: "Métricas Clave",
                        dataPoints: [
                            "ETFs de Bitcoin: $2.1B en entradas semanales",
                            "Resistencia rota en $105,000 con volumen alto",
                            "RSI en territorio de sobreventa corregido",
                            "Correlación con acciones tech disminuyendo"
                        ]
                    },
                    {
                        title: "Ethereum Prepara Actualización Crucial: Dencun Phase 2 en Camino",
                        summary: "La red Ethereum se prepara para su próxima actualización mayor que promete reducir significativamente las tarifas de gas y mejorar la escalabilidad. Los desarrolladores confirman fechas tentativas.",
                        category: "Desarrollo",
                        icon: "fa-code",
                        sentiment: "indicator-bullish",
                        time: "Hace 4 horas",
                        dataTitle: "Mejoras Esperadas",
                        dataPoints: [
                            "Reducción de gas fees hasta 90%",
                            "Incremento de throughput a 100K TPS",
                            "Compatibilidad mejorada con Layer 2",
                            "Nuevas funcionalidades para DeFi"
                        ]
                    },
                    {
                        title: "Solana Mantiene Liderazgo en Desarrolladores Activos",
                        summary: "Solana continúa atrayendo más desarrolladores que cualquier otra blockchain, con más de 8,000 developers activos mensuales. El ecosistema muestra signos de madurez y diversificación.",
                        category: "Ecosistema",
                        icon: "fa-users",
                        sentiment: "indicator-bullish",
                        time: "Hace 6 horas",
                        dataTitle: "Estadísticas de Desarrollo",
                        dataPoints: [
                            "8,247 desarrolladores activos mensuales",
                            "45% crecimiento YoY en nuevos proyectos",
                            "TVL de $8.2B en protocolos Solana",
                            "280 nuevas dApps lanzadas en Q1"
                        ]
                    },
                    {
                        title: "Regulación Crypto: UE y EE.UU. Buscan Marco Unificado",
                        summary: "Autoridades europeas y estadounidenses inician conversaciones para crear un marco regulatorio unificado que facilite la innovación mientras protege a los consumidores.",
                        category: "Regulación",
                        icon: "fa-gavel",
                        sentiment: "indicator-neutral",
                        time: "Hace 8 horas",
                        dataTitle: "Propuestas Clave",
                        dataPoints: [
                            "Estándares comunes para stablecoins",
                            "Marco unificado para ETFs crypto",
                            "Cooperación en enforcement anti-lavado",
                            "Sandbox regulatorio conjunto"
                        ]
                    },
                    {
                        title: "DeFi TVL Alcanza $95B: Recuperación Post-Bear Market Completa",
                        summary: "El Total Value Locked en protocolos DeFi alcanza $95B, marcando una recuperación completa desde los mínimos del bear market. Los protocolos de lending lideran el crecimiento.",
                        category: "DeFi",
                        icon: "fa-coins",
                        sentiment: "indicator-bullish",
                        time: "Hace 10 horas",
                        dataTitle: "Distribución TVL",
                        dataPoints: [
                            "Lending protocols: $32B (34%)",
                            "DEXs: $28B (29%)",
                            "Liquid staking: $18B (19%)",
                            "Yield farming: $17B (18%)"
                        ]
                    },
                    {
                        title: "AI Tokens Explotan: $GOAT y $ACT Lideran Sector Emergente",
                        summary: "Los tokens relacionados con inteligencia artificial experimentan un rally extraordinario, con $GOAT subiendo 400% en el mes. El sector AI x Crypto está captando atención institucional.",
                        category: "AI Tokens",
                        icon: "fa-robot",
                        sentiment: "indicator-bullish",
                        time: "Hace 12 horas",
                        dataTitle: "Performance AI Tokens",
                        dataPoints: [
                            "$GOAT: +400% mensual, $1.2B market cap",
                            "$ACT: +280% mensual, $800M market cap",
                            "Sector AI crypto: $15B market cap total",
                            "25 nuevos proyectos AI lanzados en Q1"
                        ]
                    }
                ];
            }
            
            generateDeFiData() {
                return [
                    { name: "Uniswap V3", tvl: 4200000000, category: "DEX" },
                    { name: "Aave", tvl: 3800000000, category: "Lending" },
                    { name: "Compound", tvl: 2100000000, category: "Lending" },
                    { name: "MakerDAO", tvl: 1900000000, category: "CDP" },
                    { name: "Curve", tvl: 1700000000, category: "DEX" },
                    { name: "Lido", tvl: 1500000000, category: "Staking" },
                    { name: "SushiSwap", tvl: 1200000000, category: "DEX" },
                    { name: "Balancer", tvl: 900000000, category: "DEX" },
                    { name: "Yearn", tvl: 800000000, category: "Yield" },
                    { name: "Convex", tvl: 700000000, category: "Yield" }
                ];
            }
            
            generateGlobalStats() {
                return {
                    active_cryptocurrencies: 12847,
                    markets: 987,
                    total_volume: { usd: 89000000000 },
                    market_cap_change_percentage_24h_usd: 2.4,
                    market_cap_percentage: { btc: 58.2, eth: 12.8 }
                };
            }
        }
        
        // Inicializar la aplicación cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            window.cryptoNewspaper = new CryptoNewspaper();
        });
        
        // Manejar visibilidad de la página (pausar cuando no está activa)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('📱 Página oculta - pausando actualizaciones');
            } else {
                console.log('📱 Página visible - resumiendo actualizaciones');
                if (window.cryptoNewspaper) {
                    window.cryptoNewspaper.updateDateTime();
                }
            }
        });
    </script>
</body>
</html>
