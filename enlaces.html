<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Hub Premium - Versión Compatible</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-cyan: #00F2FF;
            --secondary-blue: #0099CC;
            --accent-purple: #6366F1;
            --accent-pink: #EC4899;
            --dark-bg: #0D0F1A;
            --card-bg: rgba(20, 24, 40, 0.95);
            --glass-border: rgba(0, 242, 255, 0.3);
            --text-primary: #E0E0E0;
            --text-secondary: #9CA3AF;
            --success-green: #10B981;
            --warning-yellow: #F59E0B;
            --error-red: #EF4444;
        }

        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-cyan) transparent;
        }

        *::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        *::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        *::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--primary-cyan), var(--secondary-blue));
            border-radius: 10px;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #0D0F1A 0%, #1A1B2E 25%, #16213E 50%, #1A1B2E 75%, #0D0F1A 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .font-orbitron { font-family: 'Orbitron', monospace; }
        .font-exo { font-family: 'Exo 2', sans-serif; }
        .font-space { font-family: 'Space Grotesk', sans-serif; }
        
        .premium-glass {
            background: linear-gradient(135deg, rgba(20, 24, 40, 0.95) 0%, rgba(30, 34, 50, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 242, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .premium-glass::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .premium-glass:hover::before {
            left: 100%;
        }
        
        .premium-glass:hover {
            border-color: rgba(0, 242, 255, 0.6);
            box-shadow: 0 12px 40px rgba(0, 242, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .neon-button {
            background: linear-gradient(45deg, var(--primary-cyan), var(--secondary-blue));
            color: var(--dark-bg);
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.4);
            border: 2px solid var(--primary-cyan);
            position: relative;
            overflow: hidden;
        }
        
        .neon-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .neon-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .neon-button:hover {
            box-shadow: 0 6px 25px rgba(0, 242, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .neon-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .neon-button-outline {
            background: transparent;
            color: var(--primary-cyan);
            border: 2px solid var(--primary-cyan);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .neon-button-outline::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .neon-button-outline:hover::before {
            left: 100%;
        }
        
        .neon-button-outline:hover {
            background: rgba(0, 242, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 242, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .premium-search {
            background: linear-gradient(135deg, rgba(20, 24, 40, 0.95) 0%, rgba(30, 34, 50, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px rgba(0, 242, 255, 0.1);
        }
        
        .premium-search:focus-within {
            border-color: rgba(0, 242, 255, 0.8);
            box-shadow: 0 12px 40px rgba(0, 242, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .premium-input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.1rem;
            outline: none;
            font-weight: 500;
        }
        
        .premium-input::placeholder {
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }
        
        .modal.is-visible {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-glass {
            background: linear-gradient(135deg, rgba(13, 15, 26, 0.98) 0%, rgba(20, 24, 40, 0.95) 100%);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 242, 255, 0.4);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0.9);
            box-shadow: 0 20px 60px rgba(0, 242, 255, 0.2);
        }
        
        .modal.is-visible .modal-glass {
            transform: scale(1);
        }
        
        .form-input {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.12) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .form-input:focus {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.16) 100%);
            border-color: var(--primary-cyan);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
            outline: none;
        }
        
        .premium-card {
            height: 260px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }
        
        .premium-card:hover {
            transform: translateY(-5px);
        }
        
        .premium-card.deleting {
            border-color: var(--error-red) !important;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.6) !important;
            transform: scale(0.95) !important;
        }
        
        .premium-image {
            height: 130px;
            object-fit: cover;
            width: 100%;
            transition: transform 0.3s ease;
        }
        
        .premium-card:hover .premium-image {
            transform: scale(1.05);
        }
        
        .premium-content {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .premium-info {
            flex: 1;
        }
        
        .premium-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .premium-action-btn {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.8rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 10;
            touch-action: manipulation;
        }
        
        .detail-btn {
            background: rgba(0, 242, 255, 0.15);
            color: var(--primary-cyan);
            border: 1px solid rgba(0, 242, 255, 0.3);
        }
        
        .detail-btn:hover {
            background: rgba(0, 242, 255, 0.25);
            border-color: rgba(0, 242, 255, 0.5);
            transform: translateY(-1px);
        }
        
        .go-btn {
            background: linear-gradient(45deg, var(--primary-cyan), var(--secondary-blue));
            color: var(--dark-bg);
            border: 1px solid var(--primary-cyan);
        }
        
        .go-btn:hover {
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.4);
            transform: translateY(-1px);
        }
        
        .export-btn {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning-yellow);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .export-btn:hover {
            background: rgba(245, 158, 11, 0.25);
            border-color: rgba(245, 158, 11, 0.5);
            transform: translateY(-1px);
        }
        
        .floating-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 242, 255, 0.3) 0%, rgba(0, 242, 255, 0.1) 50%, transparent 100%);
            filter: blur(1px);
            animation: float 8s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-120px) rotate(180deg); opacity: 0.7; }
        }
        
        .premium-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 242, 255, 0.3);
            border-top: 4px solid var(--primary-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filter-btn {
            background: rgba(0, 242, 255, 0.1);
            color: var(--primary-cyan);
            border: 1px solid rgba(0, 242, 255, 0.3);
            transition: all 0.3s ease;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 500;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary-cyan);
            color: var(--dark-bg);
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.4);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(20, 24, 40, 0.95) 0%, rgba(30, 34, 50, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 242, 255, 0.2);
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-cyan);
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            color: white;
            font-weight: 500;
            max-width: 350px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%);
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .toast-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%);
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .toast-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(217, 119, 6, 0.9) 100%);
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .chart-container {
            background: linear-gradient(135deg, rgba(20, 24, 40, 0.95) 0%, rgba(30, 34, 50, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .gradient-text {
            background: linear-gradient(45deg, var(--primary-cyan), var(--secondary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 242, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 242, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 242, 255, 0); }
        }
        
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success-green);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: pulse-dot 2s infinite;
        }
        
        @keyframes pulse-dot {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .premium-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, var(--accent-purple), var(--accent-pink));
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .category-tag {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-right: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .enhanced-card {
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        .enhanced-card:hover {
            border-color: var(--primary-cyan);
            box-shadow: 0 15px 50px rgba(0, 242, 255, 0.3);
        }
        
        .import-export-section {
            background: linear-gradient(135deg, rgba(20, 24, 40, 0.95) 0%, rgba(30, 34, 50, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .dropdown-select {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.12) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .dropdown-select:focus {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.16) 100%);
            border-color: var(--primary-cyan);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
            outline: none;
        }

        .compatibility-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, var(--success-green), #059669);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 15px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .import-progress {
            background: rgba(0, 242, 255, 0.1);
            border: 1px solid rgba(0, 242, 255, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .import-progress.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-cyan), var(--secondary-blue));
            width: 0%;
            transition: width 0.3s ease;
        }

        .import-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .log-entry {
            margin: 0.2rem 0;
            padding: 0.1rem 0;
        }

        .log-entry.success {
            color: var(--success-green);
        }

        .log-entry.error {
            color: var(--error-red);
        }

        .log-entry.warning {
            color: var(--warning-yellow);
        }

        .log-entry.info {
            color: var(--primary-cyan);
        }

        /* Mejoras en navegación táctil */
        @media (max-width: 768px) {
            .premium-card {
                height: 240px;
                touch-action: pan-y;
            }
            
            .premium-image {
                height: 110px;
            }
            
            .premium-content {
                padding: 0.75rem;
            }
            
            .stats-number {
                font-size: 1.5rem;
            }
            
            .premium-actions {
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            
            .premium-action-btn {
                min-width: 60px;
                font-size: 0.7rem;
                padding: 0.4rem 0.3rem;
            }
        }
        
        @media print {
            .floating-orbs,
            .toast,
            .modal {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .premium-glass {
                background: white !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Orbes flotantes mejorados -->
    <div class="floating-orbs">
        <div class="orb" style="left: 5%; top: 20%; width: 100px; height: 100px; animation-delay: 0s;"></div>
        <div class="orb" style="left: 15%; top: 60%; width: 60px; height: 60px; animation-delay: 2s;"></div>
        <div class="orb" style="left: 30%; top: 40%; width: 80px; height: 80px; animation-delay: 4s;"></div>
        <div class="orb" style="left: 50%; top: 70%; width: 120px; height: 120px; animation-delay: 6s;"></div>
        <div class="orb" style="left: 70%; top: 30%; width: 90px; height: 90px; animation-delay: 8s;"></div>
        <div class="orb" style="left: 85%; top: 50%; width: 70px; height: 70px; animation-delay: 10s;"></div>
        <div class="orb" style="left: 90%; top: 80%; width: 110px; height: 110px; animation-delay: 12s;"></div>
    </div>

    <div id="app" class="min-h-screen">
        <!-- Encabezado Premium -->
        <header class="text-center py-8 px-4">
            <div class="mb-6">
                <div class="relative inline-block">
                    <img src="https://i.postimg.cc/mDgqGyw3/Picsart-25-03-28-04-00-43-410.png" 
                         alt="Logo" 
                         class="h-20 w-20 rounded-full border-3 border-cyan-500 mx-auto pulse-animation">
                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 opacity-20 animate-pulse"></div>
                </div>
                <div class="compatibility-indicator">
                    <i class="fas fa-sync mr-1"></i>Lunaria Compatible
                </div>
            </div>
            <h1 class="font-orbitron text-4xl font-bold text-white text-glow mb-3 gradient-text">
                CRYPTO HUB PREMIUM
            </h1>
            <p class="text-cyan-300 text-lg font-medium mb-4">Portal Avanzado de Minería Digital - Compatible con Lunaria Mining</p>
            <div class="w-32 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto"></div>
        </header>

        <!-- Estadísticas -->
        <section class="px-4 mb-8">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 max-w-6xl mx-auto">
                <div class="stats-card">
                    <div class="stats-number" id="totalSites">0</div>
                    <p class="text-gray-400 text-sm font-medium">Sitios Total</p>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="activeSites">0</div>
                    <p class="text-gray-400 text-sm font-medium">Sitios Activos</p>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalContributors">0</div>
                    <p class="text-gray-400 text-sm font-medium">Colaboradores</p>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="newToday">0</div>
                    <p class="text-gray-400 text-sm font-medium">Nuevos Hoy</p>
                </div>
            </div>
        </section>

        <!-- Sección de Importación/Exportación -->
        <section class="px-4 mb-8">
            <div class="import-export-section max-w-6xl mx-auto">
                <h3 class="font-orbitron text-xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-exchange-alt mr-2"></i>Gestión de Datos - Compatible con Lunaria Mining
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Sección de Exportación -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-cyan-300 text-lg mb-4">
                            <i class="fas fa-download mr-2"></i>Exportar Datos
                        </h4>
                        <div class="space-y-3">
                            <div class="flex gap-3">
                                <button id="exportAllJSON" class="flex-1 neon-button py-2 px-4 rounded-lg font-medium">
                                    <i class="fas fa-file-code mr-2"></i>Exportar Todo (JSON)
                                </button>
                                <button id="exportAllCSV" class="flex-1 neon-button-outline py-2 px-4 rounded-lg font-medium">
                                    <i class="fas fa-file-csv mr-2"></i>Exportar Todo (CSV)
                                </button>
                            </div>
                            <div class="flex gap-3">
                                <button id="exportLunariaFormat" class="flex-1 neon-button py-2 px-4 rounded-lg font-medium">
                                    <i class="fas fa-gem mr-2"></i>Formato Lunaria
                                </button>
                                <button id="exportCategoryBtn" class="flex-1 neon-button-outline py-2 px-4 rounded-lg font-medium">
                                    <i class="fas fa-filter mr-2"></i>Por Categoría
                                </button>
                            </div>
                            <select id="exportCategorySelect" class="dropdown-select rounded-lg px-3 py-2 w-full">
                                <option value="all">Todas las categorías</option>
                                <option value="faucets">Faucets</option>
                                <option value="mining">Mining</option>
                                <option value="staking">Staking</option>
                                <option value="defi">DeFi</option>
                                <option value="trading">Trading</option>
                                <option value="shortlink">Shortlink</option>
                                <option value="otros">Otros</option>
                            </select>
                        </div>
                    </div>

                    <!-- Sección de Importación -->
                    <div class="space-y-4">
                        <h4 class="font-semibold text-cyan-300 text-lg mb-4">
                            <i class="fas fa-upload mr-2"></i>Importar Datos
                        </h4>
                        <div class="space-y-3">
                            <div class="flex gap-3">
                                <label for="importFile" class="flex-1 neon-button-outline py-2 px-4 rounded-lg font-medium cursor-pointer text-center">
                                    <i class="fas fa-file-upload mr-2"></i>Seleccionar Archivo
                                </label>
                                <input type="file" id="importFile" accept=".json,.csv" class="hidden">
                                <button id="importDataBtn" class="neon-button py-2 px-4 rounded-lg font-medium" disabled>
                                    <i class="fas fa-upload mr-2"></i>Importar
                                </button>
                            </div>
                            <div class="text-center">
                                <p id="importFileName" class="text-gray-400 text-sm">Ningún archivo seleccionado</p>
                                <p class="text-gray-500 text-xs mt-1">Soporta: JSON, CSV (Crypto Hub & Lunaria)</p>
                            </div>
                        </div>
                        
                        <!-- Progreso de importación -->
                        <div id="importProgress" class="import-progress">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-cyan-300 font-medium">Procesando archivo...</span>
                                <span id="importProgressText" class="text-sm text-gray-400">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="importProgressBar" class="progress-fill"></div>
                            </div>
                            <div id="importLog" class="import-log"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Buscador Premium -->
        <div class="px-4 mb-8">
            <div class="premium-search p-4 mx-auto max-w-3xl">
                <div class="flex items-center gap-4">
                    <i class="fas fa-search text-cyan-400 text-xl"></i>
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="premium-input flex-1 p-3 font-space" 
                        placeholder="Buscar sitios, nombres, descripciones o colaboradores..."
                        autocomplete="off"
                    >
                    <button id="clearSearch" class="text-cyan-400 hover:text-cyan-300 transition-colors p-2 hidden">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Filtros por Categoría -->
        <div class="px-4 mb-8">
            <div class="flex flex-wrap justify-center gap-3 max-w-6xl mx-auto">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-globe mr-2"></i>Todas
                </button>
                <button class="filter-btn" data-filter="faucets">
                    <i class="fas fa-faucet mr-2"></i>Faucets
                </button>
                <button class="filter-btn" data-filter="mining">
                    <i class="fas fa-pickaxe mr-2"></i>Mining
                </button>
                <button class="filter-btn" data-filter="staking">
                    <i class="fas fa-coins mr-2"></i>Staking
                </button>
                <button class="filter-btn" data-filter="defi">
                    <i class="fas fa-chart-line mr-2"></i>DeFi
                </button>
                <button class="filter-btn" data-filter="trading">
                    <i class="fas fa-exchange-alt mr-2"></i>Trading
                </button>
                <button class="filter-btn" data-filter="shortlink">
                    <i class="fas fa-link mr-2"></i>Shortlink
                </button>
                <button class="filter-btn" data-filter="otros">
                    <i class="fas fa-folder mr-2"></i>Otros
                </button>
            </div>
        </div>

        <!-- Botón añadir -->
        <div class="text-center mb-8 px-4">
            <button id="addLinkBtn" class="neon-button py-4 px-8 rounded-xl font-semibold text-lg" disabled>
                <i class="fas fa-plus mr-3"></i>Añadir Sitio Premium
            </button>
        </div>

        <!-- Publicidad 1 -->
        <div class="px-4 mb-8 text-center">
            <div class="premium-glass p-6 rounded-2xl max-w-4xl mx-auto">
                <h3 class="font-orbitron text-lg font-bold text-white mb-4">Partner Premium</h3>
                <a href="https://wexon.pro/partner/sneyder" target="_blank" rel="noopener noreferrer">
                    <img src="https://wexon.pro/img/a/horizontal-lg.gif" 
                         class="mx-auto rounded-lg max-w-full h-auto hover:scale-105 transition-transform duration-300" 
                         alt="Wexon Partner Premium"/>
                </a>
            </div>
        </div>

        <!-- Gráfico de Actividad -->
        <div class="px-4 mb-8">
            <div class="chart-container max-w-6xl mx-auto">
                <h3 class="font-orbitron text-xl font-bold text-white mb-6 text-center">
                    <i class="fas fa-chart-line mr-2"></i>Actividad del Portal
                </h3>
                <div style="height: 300px;">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Contenedor de resultados -->
        <div class="px-4 mb-8">
            <div id="searchResults" class="text-center text-gray-400 mb-6 hidden">
                <i class="fas fa-search mr-2"></i>
                <span id="resultsCount">0</span> resultado(s) encontrado(s)
            </div>
            
            <main id="linksContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-6 max-w-7xl mx-auto">
            </main>
        </div>
        
        <!-- Estado de carga -->
        <div id="loadingState" class="text-center py-12">
            <div class="premium-spinner mx-auto mb-6"></div>
            <p class="text-cyan-400 text-lg font-medium">Cargando datos premium...</p>
        </div>

        <!-- Sección de Colaboradores Premium -->
        <section id="collaborators" class="px-4 py-12">
            <div class="text-center mb-12">
                <h3 class="font-orbitron text-3xl font-bold text-white text-glow mb-4">
                    Colaboradores Premium
                </h3>
                <div class="w-32 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto"></div>
            </div>

            <div class="max-w-6xl mx-auto space-y-8">
                <!-- Banners Principales -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="premium-glass p-6 rounded-2xl text-center">
                        <h4 class="font-orbitron text-lg font-bold text-white mb-4">
                            <i class="fas fa-bitcoin mr-2"></i>Bitcoin Mining ATM
                        </h4>
                        <a href="https://bitcoinminingatm.com/?ref=Sneyder" target="_blank" rel="noopener noreferrer">
                            <img src="https://bitcoinminingatm.com/styles/images/468x60.gif" 
                                 alt="Bitcoin Mining ATM" 
                                 class="rounded-lg hover:scale-105 transition-all duration-300 max-w-full h-auto mx-auto"
                                 onerror="this.style.display='none'">
                        </a>
                    </div>
                    
                    <div class="premium-glass p-6 rounded-2xl text-center">
                        <h4 class="font-orbitron text-lg font-bold text-white mb-4">
                            <i class="fas fa-coins mr-2"></i>CoinPayU
                        </h4>
                        <a href="https://www.coinpayu.com/?r=Sneyder2" target="_blank" rel="noopener noreferrer">
                            <img src="https://www.coinpayu.com/static/advertiser_banner/468X60.gif" 
                                 alt="CoinPayU" 
                                 class="rounded-lg hover:scale-105 transition-all duration-300 max-w-full h-auto mx-auto"
                                 onerror="this.style.display='none'">
                        </a>
                    </div>
                </div>

                <!-- Banners Verticales -->
                <div class="premium-glass p-6 rounded-2xl">
                    <h4 class="font-orbitron text-lg font-bold text-white mb-6 text-center">
                        <i class="fas fa-star mr-2"></i>Ofertas Especiales
                    </h4>
                    <div class="flex flex-col md:flex-row justify-center items-center gap-6">
                        <a href="https://wexon.pro/partner/sneyder" target="_blank" rel="noopener noreferrer">
                            <img src="https://wexon.pro/img/a/vertical.gif" 
                                 class="rounded-lg hover:scale-105 transition-all duration-300" 
                                 alt="Wexon Vertical GIF"/>
                        </a>
                        <a href="https://wexon.pro/partner/sneyder" target="_blank" rel="noopener noreferrer">
                            <img src="https://wexon.pro/img/a/vertical.png" 
                                 class="rounded-lg hover:scale-105 transition-all duration-300" 
                                 alt="Wexon Vertical PNG"/>
                        </a>
                    </div>
                </div>

                <!-- Ofertas Premium -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <a href="https://cylindrical-wave.com/dUm.FVz/ddG/NvvQZBGVUb/geHmX9VujZfUtl/kyPQTJYO0/NqzaQv1-N/zXAMtaNnjtQo3xNqDdUu3/MSQD" 
                       target="_blank" rel="noopener noreferrer" 
                       class="premium-glass p-6 rounded-2xl flex flex-col items-center justify-center h-40 hover:scale-105 transition-all duration-300">
                        <i class="fas fa-gift text-cyan-400 text-3xl mb-3"></i>
                        <p class="font-semibold text-white text-lg">Oferta Especial</p>
                        <p class="text-cyan-300 text-sm">Promoción limitada</p>
                    </a>
                    
                    <a href="https://cylindrical-wave.com/dsmRF.zKdCGpNFvzZpGIUn/germF9muUZVU/l/k/PfTLYW0CNpzaQP1-NszPArtwN/jVQO3gNaDGUU3QMWS/Z/sbaCW/1np/dBDA0/xq" 
                       target="_blank" rel="noopener noreferrer" 
                       class="premium-glass p-6 rounded-2xl flex flex-col items-center justify-center h-40 hover:scale-105 transition-all duration-300">
                        <i class="fas fa-medal text-purple-400 text-3xl mb-3"></i>
                        <p class="font-semibold text-white text-lg">Premium Plus</p>
                        <p class="text-purple-300 text-sm">Acceso exclusivo</p>
                    </a>
                    
                    <a href="https://cylindrical-wave.com/dUm.FVz/ddG/NvvQZBGVUb/geHmX9VujZfUtl/kyPQTJYO0/NqzaQv1-N/zXAMtaNnjtQo3xNqDdUu3/MSQD" 
                       target="_blank" rel="noopener noreferrer" 
                       class="premium-glass p-6 rounded-2xl flex flex-col items-center justify-center h-40 hover:scale-105 transition-all duration-300">
                        <i class="fas fa-crown text-yellow-400 text-3xl mb-3"></i>
                        <p class="font-semibold text-white text-lg">VIP Access</p>
                        <p class="text-yellow-300 text-sm">Beneficios premium</p>
                    </a>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center py-8 px-4 border-t border-gray-800">
            <div class="max-w-4xl mx-auto">
                <p class="text-gray-400 mb-4">
                    © 2024 Crypto Hub Premium. Plataforma de minería digital avanzada - Compatible con Lunaria Mining Premium.
                </p>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition-colors">
                        <i class="fab fa-telegram text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition-colors">
                        <i class="fab fa-discord text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-cyan-400 transition-colors">
                        <i class="fab fa-twitter text-xl"></i>
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal de detalles -->
    <div id="detailModal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="modal-glass rounded-3xl shadow-2xl p-8 w-full max-w-lg">
            <div class="text-center mb-8">
                <img id="detailImage" src="" alt="" class="w-28 h-28 rounded-2xl mx-auto mb-6 object-cover border-2 border-cyan-500/50">
                <h2 id="detailTitle" class="font-orbitron text-2xl font-bold text-white mb-3"></h2>
                <p id="detailSubmitter" class="text-cyan-300 text-base mb-4"></p>
                <div class="w-20 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto mb-6"></div>
            </div>
            
            <div class="mb-8">
                <h3 class="text-cyan-300 font-semibold mb-3 text-lg">
                    <i class="fas fa-info-circle mr-2"></i>Descripción:
                </h3>
                <p id="detailDescription" class="text-gray-300 leading-relaxed"></p>
            </div>
            
            <div class="flex gap-4">
                <button id="closeDetailBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-all">
                    <i class="fas fa-times mr-2"></i>Cerrar
                </button>
                <button id="goToSiteBtn" class="flex-1 neon-button py-3 px-6 rounded-xl font-semibold">
                    <i class="fas fa-external-link-alt mr-2"></i>Visitar Sitio
                </button>
            </div>
        </div>
    </div>

    <!-- Modal añadir sitio -->
    <div id="addLinkModal" class="modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50">
        <div class="modal-glass rounded-3xl shadow-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-8">
                <i class="fas fa-plus-circle text-cyan-500 text-4xl mb-4"></i>
                <h2 class="font-orbitron text-2xl font-bold text-white mb-2">Añadir Sitio Premium</h2>
                <div class="w-20 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto"></div>
            </div>
            
            <form id="addLinkForm" class="space-y-6">
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-user mr-2"></i>Tu Nombre
                    </label>
                    <input type="text" id="submitterName" class="form-input w-full rounded-xl px-4 py-3" placeholder="Ingresa tu nombre" required>
                </div>
                
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-tag mr-2"></i>Nombre del Sitio
                    </label>
                    <input type="text" id="siteName" class="form-input w-full rounded-xl px-4 py-3" placeholder="Nombre del sitio" required>
                </div>
                
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-list mr-2"></i>Categoría
                    </label>
                    <select id="siteCategory" class="dropdown-select w-full rounded-xl px-4 py-3" required>
                        <option value="">Selecciona una categoría</option>
                        <option value="faucets">Faucets</option>
                        <option value="mining">Mining</option>
                        <option value="staking">Staking</option>
                        <option value="defi">DeFi</option>
                        <option value="trading">Trading</option>
                        <option value="shortlink">Shortlink</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-info-circle mr-2"></i>Descripción
                    </label>
                    <textarea id="siteDescription" rows="4" class="form-input w-full rounded-xl px-4 py-3" placeholder="Describe el sitio..." required></textarea>
                </div>
                
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-image mr-2"></i>Imagen (Opcional)
                    </label>
                    <label for="siteImageFile" class="neon-button-outline w-full text-center py-3 px-6 rounded-xl cursor-pointer flex items-center justify-center gap-3">
                        <i class="fas fa-upload text-lg"></i>
                        <span>Seleccionar Imagen</span>
                    </label>
                    <input type="file" id="siteImageFile" class="hidden" accept="image/*">
                    <p id="file-chosen" class="text-center text-sm text-gray-400 mt-3">Sin archivo seleccionado</p>
                    <img id="imagePreview" class="mt-4 rounded-xl hidden max-h-40 mx-auto border-2 border-cyan-500/50"/>
                </div>
                
                <div>
                    <label class="block text-cyan-300 text-sm font-bold mb-3">
                        <i class="fas fa-link mr-2"></i>URL del Sitio
                    </label>
                    <input type="url" id="siteUrl" class="form-input w-full rounded-xl px-4 py-3" placeholder="https://ejemplo.com" required>
                </div>
                
                <div class="flex gap-4 pt-4">
                    <button type="button" id="cancelAddBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-all">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit" id="saveBtn" class="flex-1 neon-button py-3 px-6 rounded-xl font-semibold">
                        <span id="saveBtnText">
                            <i class="fas fa-save mr-2"></i>Guardar
                        </span>
                        <div id="saveSpinner" class="hidden">
                            <div class="premium-spinner w-5 h-5 mx-auto"></div>
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal confirmación eliminar -->
    <div id="deleteConfirmModal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="modal-glass rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                <h2 class="font-orbitron text-xl font-bold text-white mb-2">Eliminar Registro</h2>
                <div class="w-20 h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent mx-auto"></div>
            </div>
            
            <p class="text-gray-300 mb-6 text-center">Ingresa la clave maestra para confirmar:</p>
            
            <div class="mb-8">
                <input type="password" id="deletePassword" class="form-input w-full rounded-xl px-4 py-3" placeholder="Clave maestra">
            </div>
            
            <div class="flex gap-4">
                <button id="cancelDeleteBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-all">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
                <button id="confirmDeleteBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-xl transition-all">
                    <i class="fas fa-trash mr-2"></i>Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de exportación individual -->
    <div id="exportModal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="modal-glass rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <i class="fas fa-download text-cyan-500 text-4xl mb-4"></i>
                <h2 class="font-orbitron text-xl font-bold text-white mb-2">Exportar Tarjeta</h2>
                <div class="w-20 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto"></div>
            </div>
            
            <p class="text-gray-300 mb-6 text-center">Selecciona el formato de exportación:</p>
            
            <div class="space-y-4">
                <button id="exportSingleJSON" class="w-full neon-button py-3 px-6 rounded-xl font-semibold">
                    <i class="fas fa-file-code mr-2"></i>Exportar como JSON
                </button>
                <button id="exportSingleCSV" class="w-full neon-button-outline py-3 px-6 rounded-xl font-semibold">
                    <i class="fas fa-file-csv mr-2"></i>Exportar como CSV
                </button>
                <button id="exportSingleLunaria" class="w-full neon-button py-3 px-6 rounded-xl font-semibold">
                    <i class="fas fa-gem mr-2"></i>Formato Lunaria
                </button>
                <button id="cancelExportBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-all">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Premium -->
    <div id="toast" class="toast">
        <div class="flex items-center">
            <i id="toastIcon" class="fas fa-check-circle mr-3 text-lg"></i>
            <p id="toastMessage" class="font-medium"></p>
        </div>
    </div>

    <script type="module">
        // Configuración Supabase
        const SUPABASE_URL = 'https://mvxsaezwbyqcsjrfhmff.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12eHNhZXp3YnlxY3NqcmZobWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxMzYxNzgsImV4cCI6MjA2NzcxMjE3OH0.9_rKY6DS-GUIU2QOqPN457rWptQefU-59YQTXW3OD7s';
        const DEFAULT_IMAGE_URL = 'https://i.postimg.cc/mDgqGyw3/Picsart-25-03-28-04-00-43-410.png';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Variables globales
        let allLinks = [];
        let filteredLinks = [];
        let linkToDeleteId = null;
        let linkToExportId = null;
        let currentDetailLink = null;
        let currentFilter = 'all';
        let activityChart = null;
        let deleteTimer = null;

        // FUNCIONES DE COMPATIBILIDAD LUNARIA MINING PREMIUM
        
        // Mapeo de categorías: Crypto Hub Premium -> Lunaria Mining Premium
        const mapCategoryToLunaria = (cryptoHubCategory) => {
            const categoryMapping = {
                'faucets': 'faucet',
                'mining': 'mining',
                'staking': 'staking',
                'defi': 'defi',
                'trading': 'trading',
                'shortlink': 'shorlin',
                'otros': 'other'
            };
            return categoryMapping[cryptoHubCategory] || 'other';
        };

        // Mapeo de categorías: Lunaria Mining Premium -> Crypto Hub Premium
        const mapCategoryFromLunaria = (lunariaCategory) => {
            const categoryMapping = {
                'faucet': 'faucets',
                'mining': 'mining',
                'staking': 'staking',
                'defi': 'defi',
                'trading': 'trading',
                'shorlin': 'shortlink',
                'other': 'otros'
            };
            return categoryMapping[lunariaCategory] || 'otros';
        };

        // Validador específico para datos de Lunaria
        const validateLunariaEntry = (entry) => {
            const validCategories = ['faucet', 'mining', 'staking', 'defi', 'trading', 'shorlin', 'other'];
            const isLunariaFormat = entry.hasOwnProperty('tags') && 
                                   validCategories.includes(entry.category) &&
                                   entry.hasOwnProperty('image');
            
            return {
                isLunariaFormat,
                hasRequiredFields: !!(entry.name && entry.category)
            };
        };

        // Parser CSV mejorado para ambos formatos
        const parseCSVCompatible = (csvText) => {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                throw new Error('El archivo CSV debe tener al menos una línea de encabezado y una de datos');
            }
            
            const headers = parseCSVLine(lines[0]);
            const entries = [];
            
            // Detectar formato basándose en headers
            const isLunariaFormat = headers.some(h => 
                h.toLowerCase().includes('etiquetas') || 
                h.toLowerCase().includes('tags') ||
                h.toLowerCase().includes('imagen')
            );
            
            logImportProcess(`Formato detectado: ${isLunariaFormat ? 'Lunaria Mining Premium' : 'Crypto Hub Premium'}`, 'info');
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length === 0) continue;
                
                const entry = {};
                headers.forEach((header, index) => {
                    const normalizedHeader = header.toLowerCase().trim();
                    let value = values[index] || '';
                    
                    // Mapear headers comunes
                    if (normalizedHeader.includes('nombre') || normalizedHeader.includes('name')) {
                        entry.name = value;
                    } else if (normalizedHeader.includes('categoría') || normalizedHeader.includes('category')) {
                        entry.category = value;
                    } else if (normalizedHeader.includes('url') || normalizedHeader.includes('link')) {
                        entry.url = value;
                    } else if (normalizedHeader.includes('descripción') || normalizedHeader.includes('description')) {
                        entry.description = value;
                    } else if (normalizedHeader.includes('colaborador') || normalizedHeader.includes('submitter')) {
                        entry.submitter_name = value;
                    } else if (normalizedHeader.includes('etiquetas') || normalizedHeader.includes('tags')) {
                        entry.tags = value ? value.split(';').map(tag => tag.trim()) : [];
                    } else if (normalizedHeader.includes('imagen') || normalizedHeader.includes('image')) {
                        entry.image_url = value;
                    } else if (normalizedHeader.includes('fecha') || normalizedHeader.includes('date') || normalizedHeader.includes('created')) {
                        entry.created_at = value;
                    }
                });
                
                if (entry.name) {
                    // Marcar el formato de origen
                    entry._sourceFormat = isLunariaFormat ? 'lunaria' : 'cryptohub';
                    entries.push(entry);
                }
            }
            
            return entries;
        };

        // Función para parsear línea CSV
        const parseCSVLine = (line) => {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"' && (i === 0 || line[i-1] === ',')) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes && (i === line.length - 1 || line[i+1] === ',')) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        };

        // Función para convertir datos a formato Lunaria
        const convertToLunariaFormat = (cryptoHubData) => {
            return cryptoHubData.map(item => ({
                id: item.id,
                name: item.name,
                category: mapCategoryToLunaria(item.category || 'otros'),
                url: item.url || '',
                description: item.description || '',
                tags: item.submitter_name ? [item.submitter_name] : [],
                image: item.image_url || DEFAULT_IMAGE_URL,
                createdAt: item.created_at || new Date().toISOString(),
                updatedAt: item.updated_at || new Date().toISOString()
            }));
        };

        // Función para convertir datos desde formato Lunaria
        const convertFromLunariaFormat = (lunariaData) => {
            return lunariaData.map(item => ({
                id: item.id || generateId(),
                name: item.name,
                category: mapCategoryFromLunaria(item.category || 'other'),
                url: item.url || '',
                description: item.description || '',
                submitter_name: (item.tags && item.tags.length > 0) ? item.tags[0] : 'Importado desde Lunaria',
                image_url: item.image || DEFAULT_IMAGE_URL,
                created_at: item.createdAt || new Date().toISOString(),
                updated_at: item.updatedAt || new Date().toISOString()
            }));
        };

        // Función para logging del proceso de importación
        const logImportProcess = (message, type = 'info') => {
            const logContainer = document.getElementById('importLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : type === 'warning' ? '⚠' : 'ℹ';
            
            logEntry.innerHTML = `[${timestamp}] ${icon} ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        // Función para mostrar progreso de importación
        const showImportProgress = (show = true) => {
            const progressContainer = document.getElementById('importProgress');
            if (show) {
                progressContainer.classList.add('show');
                document.getElementById('importLog').innerHTML = '';
            } else {
                progressContainer.classList.remove('show');
            }
        };

        // Función para actualizar barra de progreso
        const updateImportProgress = (percentage, text = '') => {
            const progressBar = document.getElementById('importProgressBar');
            const progressText = document.getElementById('importProgressText');
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = text || `${percentage}%`;
        };

        // Categorías disponibles
        const CATEGORIES = {
            faucets: { name: 'Faucets', color: 'bg-blue-500 text-white', icon: 'fas fa-faucet' },
            mining: { name: 'Mining', color: 'bg-yellow-500 text-white', icon: 'fas fa-pickaxe' },
            staking: { name: 'Staking', color: 'bg-purple-500 text-white', icon: 'fas fa-coins' },
            defi: { name: 'DeFi', color: 'bg-green-500 text-white', icon: 'fas fa-chart-line' },
            trading: { name: 'Trading', color: 'bg-red-500 text-white', icon: 'fas fa-exchange-alt' },
            shortlink: { name: 'Shortlink', color: 'bg-indigo-500 text-white', icon: 'fas fa-link' },
            otros: { name: 'Otros', color: 'bg-gray-500 text-white', icon: 'fas fa-folder' }
        };

        // Elementos DOM
        const elements = {
            linksContainer: document.getElementById('linksContainer'),
            loadingState: document.getElementById('loadingState'),
            searchInput: document.getElementById('searchInput'),
            clearSearch: document.getElementById('clearSearch'),
            searchResults: document.getElementById('searchResults'),
            resultsCount: document.getElementById('resultsCount'),
            addLinkBtn: document.getElementById('addLinkBtn'),
            addLinkModal: document.getElementById('addLinkModal'),
            addLinkForm: document.getElementById('addLinkForm'),
            detailModal: document.getElementById('detailModal'),
            deleteConfirmModal: document.getElementById('deleteConfirmModal'),
            exportModal: document.getElementById('exportModal'),
            toast: document.getElementById('toast'),
            totalSites: document.getElementById('totalSites'),
            activeSites: document.getElementById('activeSites'),
            totalContributors: document.getElementById('totalContributors'),
            newToday: document.getElementById('newToday')
        };

        // Utilidades
        const toggleModal = (modal, show) => {
            if (show) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                setTimeout(() => modal.classList.add('is-visible'), 10);
            } else {
                modal.classList.remove('is-visible');
                document.body.style.overflow = 'auto';
                setTimeout(() => {
                    modal.style.display = 'none';
                    if (modal.id === 'addLinkModal') {
                        elements.addLinkForm.reset();
                        document.getElementById('file-chosen').textContent = 'Sin archivo seleccionado';
                        document.getElementById('imagePreview').classList.add('hidden');
                        document.getElementById('imagePreview').src = '';
                    }
                }, 300);
            }
        };

        const showToast = (message, type = 'success') => {
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            elements.toast.className = 'toast';
            
            switch (type) {
                case 'success':
                    elements.toast.classList.add('toast-success');
                    toastIcon.className = 'fas fa-check-circle mr-3 text-lg';
                    break;
                case 'error':
                    elements.toast.classList.add('toast-error');
                    toastIcon.className = 'fas fa-exclamation-circle mr-3 text-lg';
                    break;
                case 'warning':
                    elements.toast.classList.add('toast-warning');
                    toastIcon.className = 'fas fa-exclamation-triangle mr-3 text-lg';
                    break;
            }
            
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 4000);
        };

        // Funciones de exportación mejoradas
        const downloadFile = (data, filename, type) => {
            const blob = new Blob([data], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        const exportToJSON = (data, filename) => {
            const jsonData = JSON.stringify(data, null, 2);
            downloadFile(jsonData, filename, 'application/json');
        };

        const exportToCSV = (data, filename) => {
            if (data.length === 0) {
                showToast('No hay datos para exportar', 'warning');
                return;
            }

            const headers = ['ID', 'Nombre', 'Descripción', 'URL', 'Categoría', 'Colaborador', 'Fecha Creación'];
            const csvContent = [
                headers.join(','),
                ...data.map(item => [
                    item.id,
                    `"${item.name || ''}"`,
                    `"${(item.description || '').replace(/"/g, '""')}"`,
                    item.url || '',
                    item.category || 'otros',
                    `"${item.submitter_name || 'Anónimo'}"`,
                    item.created_at || ''
                ].join(','))
            ].join('\n');

            downloadFile(csvContent, filename, 'text/csv');
        };

        // Exportación en formato Lunaria Mining Premium
        const exportToLunariaFormat = (data, filename) => {
            const lunariaData = convertToLunariaFormat(data);
            const exportData = {
                version: '1.0.0',
                exportDate: new Date().toISOString(),
                exportType: 'lunaria_compatible',
                totalEntries: lunariaData.length,
                source: 'Crypto Hub Premium',
                entries: lunariaData
            };

            exportToJSON(exportData, filename);
        };

        const exportAllData = (format) => {
            if (allLinks.length === 0) {
                showToast('No hay datos para exportar', 'warning');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `crypto_hub_export_${timestamp}.${format}`;

            if (format === 'json') {
                exportToJSON(allLinks, filename);
            } else if (format === 'csv') {
                exportToCSV(allLinks, filename);
            }

            showToast(`Datos exportados exitosamente como ${format.toUpperCase()}`, 'success');
        };

        const exportAllDataLunariaFormat = () => {
            if (allLinks.length === 0) {
                showToast('No hay datos para exportar', 'warning');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `crypto_hub_lunaria_export_${timestamp}.json`;

            exportToLunariaFormat(allLinks, filename);
            showToast('Datos exportados en formato Lunaria Mining Premium', 'success');
        };

        const exportCategoryData = (category) => {
            let dataToExport = allLinks;
            
            if (category !== 'all') {
                dataToExport = allLinks.filter(link => (link.category || 'otros') === category);
            }

            if (dataToExport.length === 0) {
                showToast('No hay datos en esta categoría para exportar', 'warning');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];
            const categoryName = category === 'all' ? 'todos' : category;
            const filename = `crypto_hub_${categoryName}_${timestamp}.json`;

            exportToJSON(dataToExport, filename);
            showToast(`Categoría "${categoryName}" exportada exitosamente`, 'success');
        };

        const exportSingleCard = (link, format) => {
            const timestamp = new Date().toISOString().split('T')[0];
            const safeName = link.name.replace(/[^a-zA-Z0-9]/g, '_');
            const filename = `crypto_hub_${safeName}_${timestamp}.${format}`;

            if (format === 'json') {
                exportToJSON([link], filename);
            } else if (format === 'csv') {
                exportToCSV([link], filename);
            } else if (format === 'lunaria') {
                exportToLunariaFormat([link], filename);
            }

            showToast(`Tarjeta exportada exitosamente como ${format.toUpperCase()}`, 'success');
        };

        // Función de importación mejorada con compatibilidad Lunaria
        const importData = async (file) => {
            try {
                showImportProgress(true);
                updateImportProgress(0, 'Iniciando importación...');
                logImportProcess('Iniciando proceso de importación', 'info');

                const text = await file.text();
                let data;
                let detectedFormat = 'unknown';

                updateImportProgress(10, 'Analizando archivo...');

                if (file.name.endsWith('.json')) {
                    data = JSON.parse(text);
                    detectedFormat = 'json';
                    logImportProcess('Archivo JSON detectado', 'info');
                } else if (file.name.endsWith('.csv')) {
                    data = parseCSVCompatible(text);
                    detectedFormat = 'csv';
                    logImportProcess('Archivo CSV detectado', 'info');
                } else {
                    throw new Error('Formato de archivo no soportado');
                }

                updateImportProgress(20, 'Procesando datos...');

                // Extraer entradas del JSON
                let entries = [];
                if (detectedFormat === 'json') {
                    if (Array.isArray(data)) {
                        entries = data;
                    } else if (data.entries && Array.isArray(data.entries)) {
                        entries = data.entries;
                        logImportProcess(`Formato estructurado detectado. Fuente: ${data.source || 'No especificada'}`, 'info');
                    } else {
                        throw new Error('Formato JSON no reconocido');
                    }
                } else {
                    entries = data;
                }

                updateImportProgress(30, 'Validando entradas...');

                // Validar y procesar datos
                const processedEntries = [];
                let lunariaCount = 0;
                let cryptoHubCount = 0;
                let errorCount = 0;

                for (let i = 0; i < entries.length; i++) {
                    const entry = entries[i];
                    const progress = 30 + (i / entries.length) * 40;
                    updateImportProgress(progress, `Procesando entrada ${i + 1}/${entries.length}`);

                    try {
                        const validation = validateLunariaEntry(entry);
                        let processedEntry;

                        if (validation.isLunariaFormat) {
                            // Convertir desde formato Lunaria
                            processedEntry = convertFromLunariaFormat([entry])[0];
                            lunariaCount++;
                            logImportProcess(`Entrada Lunaria convertida: ${entry.name}`, 'success');
                        } else {
                            // Procesar como formato Crypto Hub
                            processedEntry = {
                                name: entry.name || 'Sin nombre',
                                description: entry.description || '',
                                url: entry.url || '',
                                category: entry.category || 'otros',
                                submitter_name: entry.submitter_name || entry.colaborador || 'Importado',
                                image_url: entry.image_url || entry.image || DEFAULT_IMAGE_URL
                            };
                            cryptoHubCount++;
                            logImportProcess(`Entrada Crypto Hub procesada: ${entry.name}`, 'success');
                        }

                        processedEntries.push(processedEntry);
                    } catch (error) {
                        errorCount++;
                        logImportProcess(`Error procesando entrada ${i + 1}: ${error.message}`, 'error');
                    }
                }

                updateImportProgress(70, 'Guardando en base de datos...');

                // Insertar datos en la base de datos
                let successCount = 0;
                let duplicateCount = 0;

                for (let i = 0; i < processedEntries.length; i++) {
                    const item = processedEntries[i];
                    const progress = 70 + (i / processedEntries.length) * 25;
                    updateImportProgress(progress, `Guardando ${i + 1}/${processedEntries.length}`);

                    try {
                        // Verificar duplicados
                        const { data: existingData } = await supabaseClient
                            .from('links')
                            .select('id')
                            .eq('name', item.name)
                            .limit(1);

                        if (existingData && existingData.length > 0) {
                            duplicateCount++;
                            logImportProcess(`Entrada duplicada omitida: ${item.name}`, 'warning');
                            continue;
                        }

                        const { error } = await supabaseClient
                            .from('links')
                            .insert(item);

                        if (error) {
                            throw error;
                        }

                        successCount++;
                        logImportProcess(`Entrada guardada: ${item.name}`, 'success');
                    } catch (err) {
                        console.error('Error inserting item:', err);
                        logImportProcess(`Error guardando ${item.name}: ${err.message}`, 'error');
                    }
                }

                updateImportProgress(100, 'Completado');

                // Mostrar resumen
                logImportProcess('=== RESUMEN DE IMPORTACIÓN ===', 'info');
                logImportProcess(`Entradas procesadas: ${processedEntries.length}`, 'info');
                logImportProcess(`Formato Lunaria: ${lunariaCount}`, 'info');
                logImportProcess(`Formato Crypto Hub: ${cryptoHubCount}`, 'info');
                logImportProcess(`Guardadas exitosamente: ${successCount}`, 'success');
                logImportProcess(`Duplicados omitidos: ${duplicateCount}`, 'warning');
                logImportProcess(`Errores: ${errorCount}`, 'error');

                const message = `Importación completada: ${successCount} exitosos, ${duplicateCount} duplicados, ${errorCount} errores`;
                showToast(message, errorCount > 0 ? 'warning' : 'success');

                // Recargar datos
                setTimeout(() => {
                    fetchLinks();
                    showImportProgress(false);
                }, 2000);

            } catch (error) {
                console.error('Import error:', error);
                logImportProcess(`Error crítico: ${error.message}`, 'error');
                showToast(`Error al importar: ${error.message}`, 'error');
                updateImportProgress(0, 'Error');
            }
        };

        // Actualizar estadísticas
        const updateStats = () => {
            const totalSites = allLinks.length;
            const activeSites = allLinks.filter(link => link.url && link.url.trim() !== '').length;
            const contributors = new Set(allLinks.map(link => link.submitter_name || 'Anónimo')).size;
            const today = new Date().toISOString().split('T')[0];
            const newToday = allLinks.filter(link => link.created_at && link.created_at.startsWith(today)).length;

            // Animación de contador
            const animateCounter = (element, targetValue, duration = 1000) => {
                const startValue = parseInt(element.textContent) || 0;
                const increment = (targetValue - startValue) / (duration / 16);
                let currentValue = startValue;
                
                const counter = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= targetValue) {
                        element.textContent = targetValue;
                        clearInterval(counter);
                    } else {
                        element.textContent = Math.floor(currentValue);
                    }
                }, 16);
            };

            animateCounter(elements.totalSites, totalSites);
            animateCounter(elements.activeSites, activeSites);
            animateCounter(elements.totalContributors, contributors);
            animateCounter(elements.newToday, newToday);
        };

        // Crear gráfico de actividad
        const createActivityChart = () => {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // Datos simulados de actividad de los últimos 7 días
            const labels = [];
            const data = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric' }));
                
                // Contar sitios añadidos en cada día
                const dayStr = date.toISOString().split('T')[0];
                const count = allLinks.filter(link => link.created_at && link.created_at.startsWith(dayStr)).length;
                data.push(count);
            }
            
            if (activityChart) {
                activityChart.destroy();
            }
            
            activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sitios Añadidos',
                        data: data,
                        borderColor: '#00F2FF',
                        backgroundColor: 'rgba(0, 242, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00F2FF',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#E0E0E0',
                                font: {
                                    family: 'Space Grotesk',
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#9CA3AF',
                                font: {
                                    family: 'Space Grotesk'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 242, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#9CA3AF',
                                font: {
                                    family: 'Space Grotesk'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 242, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        };

        // Función para determinar categoría
        const getCategory = (link) => {
            // Si tiene categoría definida, usarla
            if (link.category && CATEGORIES[link.category]) {
                return link.category;
            }
            
            // Si no, intentar determinar por nombre y descripción
            const name = link.name.toLowerCase();
            const description = (link.description || '').toLowerCase();
            
            if (name.includes('faucet') || description.includes('faucet')) {
                return 'faucets';
            } else if (name.includes('mining') || name.includes('miner') || description.includes('mining')) {
                return 'mining';
            } else if (name.includes('staking') || description.includes('staking')) {
                return 'staking';
            } else if (name.includes('defi') || description.includes('defi')) {
                return 'defi';
            } else if (name.includes('trading') || description.includes('trading')) {
                return 'trading';
            } else if (name.includes('short') || name.includes('link') || description.includes('shortlink')) {
                return 'shortlink';
            }
            
            return 'otros';
        };

        // Crear tarjeta premium mejorada
        function createPremiumCard(link) {
            const card = document.createElement('div');
            card.className = 'premium-glass rounded-2xl overflow-hidden premium-card enhanced-card fade-in';
            card.dataset.id = link.id;
            
            const category = getCategory(link);
            const categoryInfo = CATEGORIES[category];
            
            card.innerHTML = `
                <div class="relative">
                    <img src="${link.image_url || DEFAULT_IMAGE_URL}" 
                         alt="${link.name}" 
                         class="premium-image" 
                         onerror="this.src='${DEFAULT_IMAGE_URL}';">
                    
                    <div class="premium-badge">
                        <span class="category-tag ${categoryInfo.color}">
                            <i class="${categoryInfo.icon} mr-1"></i>
                            ${categoryInfo.name}
                        </span>
                    </div>
                    
                    <div class="status-indicator"></div>
                </div>
                
                <div class="premium-content">
                    <div class="premium-info">
                        <h3 class="font-semibold text-white text-sm mb-2 truncate">${link.name}</h3>
                        <p class="text-cyan-300 text-xs truncate mb-1">
                            <i class="fas fa-user mr-1"></i>${link.submitter_name || 'Anónimo'}
                        </p>
                        <p class="text-gray-400 text-xs truncate">
                            <i class="fas fa-clock mr-1"></i>${new Date(link.created_at).toLocaleDateString('es-ES')}
                        </p>
                    </div>
                    <div class="premium-actions">
                        <button class="premium-action-btn detail-btn" data-action="detail">
                            <i class="fas fa-info-circle mr-1"></i>Info
                        </button>
                        <button class="premium-action-btn go-btn" data-action="go">
                            <i class="fas fa-external-link-alt mr-1"></i>Ir
                        </button>
                        <button class="premium-action-btn export-btn" data-action="export">
                            <i class="fas fa-download mr-1"></i>
                        </button>
                    </div>
                </div>
            `;

            // Event listeners mejorados
            const detailBtn = card.querySelector('[data-action="detail"]');
            const goBtn = card.querySelector('[data-action="go"]');
            const exportBtn = card.querySelector('[data-action="export"]');
            
            detailBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                showDetailModal(link);
            });
            
            goBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                window.open(link.url, '_blank');
            });

            exportBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                linkToExportId = link.id;
                toggleModal(elements.exportModal, true);
            });

            // Mejorado sistema de long press para eliminar
            let isLongPress = false;
            let longPressTimer = null;
            let touchStartTime = 0;

            const startLongPress = (e) => {
                // Solo iniciar si no se está tocando un botón
                if (e.target.closest('.premium-action-btn') || e.target.closest('button')) {
                    return;
                }
                
                touchStartTime = Date.now();
                isLongPress = false;
                
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                }

                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    card.classList.add('deleting');
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate(200);
                    }
                    
                    linkToDeleteId = link.id;
                    toggleModal(elements.deleteConfirmModal, true);
                }, 700);
            };

            const cancelLongPress = () => {
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }
                card.classList.remove('deleting');
                
                // Pequeño delay para permitir que el click se procese
                setTimeout(() => {
                    isLongPress = false;
                }, 50);
            };

            const handleCardClick = (e) => {
                const touchDuration = Date.now() - touchStartTime;
                
                if (isLongPress || touchDuration > 500) {
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
                
                // Si no es long press y no es botón, mostrar detalles
                if (!e.target.closest('.premium-action-btn') && !e.target.closest('button')) {
                    showDetailModal(link);
                }
            };

            // Event listeners para long press (mejorado para táctil)
            card.addEventListener('mousedown', startLongPress);
            card.addEventListener('mouseup', cancelLongPress);
            card.addEventListener('mouseleave', cancelLongPress);
            card.addEventListener('touchstart', startLongPress, { passive: true });
            card.addEventListener('touchend', cancelLongPress, { passive: true });
            card.addEventListener('touchmove', cancelLongPress, { passive: true });
            card.addEventListener('touchcancel', cancelLongPress, { passive: true });
            
            // Click handler mejorado
            card.addEventListener('click', handleCardClick);

            return card;
        }

        // Mostrar modal de detalles
        function showDetailModal(link) {
            currentDetailLink = link;
            document.getElementById('detailImage').src = link.image_url || DEFAULT_IMAGE_URL;
            document.getElementById('detailTitle').textContent = link.name;
            document.getElementById('detailSubmitter').textContent = `Por: ${link.submitter_name || 'Anónimo'}`;
            document.getElementById('detailDescription').textContent = link.description || 'Sin descripción disponible.';
            toggleModal(elements.detailModal, true);
        }

        // Filtrar enlaces
        const filterLinks = (filterType) => {
            let filtered = [...allLinks];
            
            switch (filterType) {
                case 'all':
                    break;
                case 'faucets':
                case 'mining':
                case 'staking':
                case 'defi':
                case 'trading':
                case 'shortlink':
                case 'otros':
                    filtered = filtered.filter(link => getCategory(link) === filterType);
                    break;
                default:
                    break;
            }
            
            return filtered;
        };

        // Renderizar enlaces
        function renderLinks(links) {
            elements.linksContainer.innerHTML = '';
            
            if (links.length === 0 && elements.searchInput.value) {
                elements.linksContainer.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <i class="fas fa-search text-cyan-500 text-5xl mb-6"></i>
                        <p class="text-gray-400 text-lg">No se encontraron resultados para tu búsqueda.</p>
                        <p class="text-gray-500 text-sm mt-2">Intenta con otros términos de búsqueda</p>
                    </div>
                `;
            } else if (links.length === 0) {
                elements.linksContainer.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <i class="fas fa-database text-cyan-500 text-5xl mb-6"></i>
                        <p class="text-gray-400 text-lg">Aún no hay sitios en esta categoría.</p>
                        <p class="text-gray-500 text-sm mt-2">¡Sé el primero en añadir uno!</p>
                    </div>
                `;
            } else {
                links.forEach((link, index) => {
                    setTimeout(() => {
                        elements.linksContainer.appendChild(createPremiumCard(link));
                    }, index * 30);
                });
            }
        }

        // Búsqueda mejorada
        function performSearch(query) {
            const searchTerm = query.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredLinks = filterLinks(currentFilter);
                elements.searchResults.classList.add('hidden');
                elements.clearSearch.classList.add('hidden');
            } else {
                const baseFiltered = filterLinks(currentFilter);
                filteredLinks = baseFiltered.filter(link => 
                    link.name.toLowerCase().includes(searchTerm) ||
                    (link.description && link.description.toLowerCase().includes(searchTerm)) ||
                    (link.submitter_name && link.submitter_name.toLowerCase().includes(searchTerm)) ||
                    (link.url && link.url.toLowerCase().includes(searchTerm)) ||
                    (link.category && link.category.toLowerCase().includes(searchTerm))
                );
                
                elements.resultsCount.textContent = filteredLinks.length;
                elements.searchResults.classList.remove('hidden');
                elements.clearSearch.classList.remove('hidden');
            }
            
            renderLinks(filteredLinks);
        }

        // Cargar enlaces
        async function fetchLinks() {
            elements.loadingState.classList.remove('hidden');
            elements.linksContainer.innerHTML = '';
            
            try {
                const { data: links, error } = await supabaseClient
                    .from('links')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allLinks = links;
                updateStats();
                createActivityChart();
                performSearch(elements.searchInput.value);
                
                showToast(`Cargados ${links.length} sitios exitosamente`, 'success');
                
            } catch (error) {
                console.error('Error fetching links:', error);
                showToast('Error al cargar los datos', 'error');
            } finally {
                elements.loadingState.classList.add('hidden');
            }
        }

        // Guardar enlace
        async function saveLink(event) {
            event.preventDefault();
            
            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');
            const saveSpinner = document.getElementById('saveSpinner');
            
            saveBtn.disabled = true;
            saveBtnText.classList.add('hidden');
            saveSpinner.classList.remove('hidden');
            
            try {
                const file = document.getElementById('siteImageFile').files[0];
                let imageUrl = DEFAULT_IMAGE_URL;

                if (file) {
                    const filePath = `public/${Date.now()}-${file.name}`;
                    const { error: uploadError } = await supabaseClient.storage
                        .from('images')
                        .upload(filePath, file);

                    if (uploadError) throw uploadError;

                    const { data } = supabaseClient.storage
                        .from('images')
                        .getPublicUrl(filePath);
                    
                    imageUrl = data.publicUrl;
                }

                const { error: insertError } = await supabaseClient
                    .from('links')
                    .insert({
                        submitter_name: document.getElementById('submitterName').value,
                        name: document.getElementById('siteName').value,
                        description: document.getElementById('siteDescription').value,
                        url: document.getElementById('siteUrl').value,
                        category: document.getElementById('siteCategory').value,
                        image_url: imageUrl
                    });

                if (insertError) throw insertError;

                toggleModal(elements.addLinkModal, false);
                showToast('Sitio añadido exitosamente', 'success');
                
                setTimeout(() => {
                    fetchLinks();
                }, 1000);
                
            } catch (error) {
                console.error('Error saving link:', error);
                showToast(`Error al guardar: ${error.message}`, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtnText.classList.remove('hidden');
                saveSpinner.classList.add('hidden');
            }
        }

        // Eliminar enlace
        async function deleteLink() {
            const password = document.getElementById('deletePassword').value;
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            
            if (password !== '1994') {
                showToast('Clave maestra incorrecta', 'error');
                return;
            }
            
            if (!linkToDeleteId) {
                showToast('Error: No se ha seleccionado un sitio.', 'error');
                toggleModal(elements.deleteConfirmModal, false);
                return;
            }

            const originalContent = confirmBtn.innerHTML;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = `<div class="premium-spinner w-5 h-5 mx-auto"></div>`;

            try {
                const { data: linkData, error: fetchError } = await supabaseClient
                    .from('links')
                    .select('image_url')
                    .eq('id', linkToDeleteId)
                    .single();

                if (fetchError) console.warn('Could not fetch link before deleting.', fetchError);

                const { error: deleteDbError } = await supabaseClient
                    .from('links')
                    .delete()
                    .eq('id', linkToDeleteId);

                if (deleteDbError) throw deleteDbError;

                if (linkData && linkData.image_url && linkData.image_url !== DEFAULT_IMAGE_URL) {
                    const imagePath = linkData.image_url.split('/images/')[1];
                    if (imagePath) {
                        const { error: storageError } = await supabaseClient.storage
                            .from('images')
                            .remove([imagePath]);
                        if (storageError) console.error('Failed to delete image from storage:', storageError);
                    }
                }

                showToast('Sitio eliminado exitosamente', 'success');
                toggleModal(elements.deleteConfirmModal, false);
                document.getElementById('deletePassword').value = '';
                
                setTimeout(() => {
                    fetchLinks();
                }, 1000);
                
            } catch (error) {
                console.error('Error deleting link:', error);
                showToast(`Error al eliminar: ${error.message}`, 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalContent;
                linkToDeleteId = null;
                
                // Limpiar estado de eliminación
                document.querySelectorAll('.deleting').forEach(el => {
                    el.classList.remove('deleting');
                });
            }
        }

        // Función para generar ID único
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Inicialización
        async function init() {
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                if (error) throw error;
                
                if (!session) {
                    const { error: signInError } = await supabaseClient.auth.signInAnonymously();
                    if (signInError) throw signInError;
                }
                
                elements.addLinkBtn.disabled = false;
                elements.addLinkBtn.innerHTML = '<i class="fas fa-plus mr-3"></i>Añadir Sitio Premium';
                
                await fetchLinks();
                
                showToast('Plataforma compatible cargada exitosamente', 'success');
                
            } catch (error) {
                console.error('Initialization Error:', error);
                elements.addLinkBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-3"></i>Error de Conexión';
                showToast('Error de conexión con la base de datos.', 'error');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            init();

            // Búsqueda con debounce
            let searchTimeout;
            elements.searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300);
            });
            
            elements.clearSearch.addEventListener('click', () => {
                elements.searchInput.value = '';
                performSearch('');
            });

            // Filtros
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    performSearch(elements.searchInput.value);
                });
            });

            // Funciones de exportación mejoradas
            document.getElementById('exportAllJSON').addEventListener('click', () => exportAllData('json'));
            document.getElementById('exportAllCSV').addEventListener('click', () => exportAllData('csv'));
            document.getElementById('exportLunariaFormat').addEventListener('click', () => exportAllDataLunariaFormat());
            document.getElementById('exportCategoryBtn').addEventListener('click', () => {
                const category = document.getElementById('exportCategorySelect').value;
                exportCategoryData(category);
            });

            // Funciones de importación mejoradas
            document.getElementById('importFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                const fileNameEl = document.getElementById('importFileName');
                const importBtn = document.getElementById('importDataBtn');
                
                if (file) {
                    fileNameEl.textContent = file.name;
                    importBtn.disabled = false;
                } else {
                    fileNameEl.textContent = 'Ningún archivo seleccionado';
                    importBtn.disabled = true;
                }
            });

            document.getElementById('importDataBtn').addEventListener('click', () => {
                const file = document.getElementById('importFile').files[0];
                if (file) {
                    importData(file);
                }
            });

            // Exportación individual mejorada
            document.getElementById('exportSingleJSON').addEventListener('click', () => {
                const link = allLinks.find(l => l.id === linkToExportId);
                if (link) {
                    exportSingleCard(link, 'json');
                    toggleModal(elements.exportModal, false);
                }
            });

            document.getElementById('exportSingleCSV').addEventListener('click', () => {
                const link = allLinks.find(l => l.id === linkToExportId);
                if (link) {
                    exportSingleCard(link, 'csv');
                    toggleModal(elements.exportModal, false);
                }
            });

            document.getElementById('exportSingleLunaria').addEventListener('click', () => {
                const link = allLinks.find(l => l.id === linkToExportId);
                if (link) {
                    exportSingleCard(link, 'lunaria');
                    toggleModal(elements.exportModal, false);
                }
            });

            document.getElementById('cancelExportBtn').addEventListener('click', () => {
                toggleModal(elements.exportModal, false);
            });

            // Modales
            elements.addLinkBtn.addEventListener('click', () => toggleModal(elements.addLinkModal, true));
            document.getElementById('cancelAddBtn').addEventListener('click', () => toggleModal(elements.addLinkModal, false));
            document.getElementById('closeDetailBtn').addEventListener('click', () => toggleModal(elements.detailModal, false));
            document.getElementById('goToSiteBtn').addEventListener('click', () => {
                if (currentDetailLink) window.open(currentDetailLink.url, '_blank');
            });
            document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
                toggleModal(elements.deleteConfirmModal, false);
                document.getElementById('deletePassword').value = '';
                
                // Limpiar estado de eliminación
                document.querySelectorAll('.deleting').forEach(el => {
                    el.classList.remove('deleting');
                });
            });
            document.getElementById('confirmDeleteBtn').addEventListener('click', deleteLink);

            // Formularios
            elements.addLinkForm.addEventListener('submit', saveLink);

            // Subida de imagen
            document.getElementById('siteImageFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                const fileChosen = document.getElementById('file-chosen');
                const imagePreview = document.getElementById('imagePreview');
                
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB limit
                        showToast('La imagen es demasiado grande. Máximo 5MB.', 'warning');
                        e.target.value = '';
                        return;
                    }
                    
                    fileChosen.textContent = file.name;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    fileChosen.textContent = 'Sin archivo seleccionado';
                    imagePreview.classList.add('hidden');
                }
            });

            // Cerrar modales al hacer clic fuera
            [elements.detailModal, elements.deleteConfirmModal, elements.exportModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        toggleModal(modal, false);
                        
                        // Limpiar estado de eliminación si es el modal de eliminar
                        if (modal.id === 'deleteConfirmModal') {
                            document.querySelectorAll('.deleting').forEach(el => {
                                el.classList.remove('deleting');
                            });
                        }
                    }
                });
            });

            // Escape key para cerrar modales
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const visibleModal = document.querySelector('.modal.is-visible');
                    if (visibleModal) {
                        toggleModal(visibleModal, false);
                        
                        // Limpiar estado de eliminación
                        document.querySelectorAll('.deleting').forEach(el => {
                            el.classList.remove('deleting');
                        });
                    }
                }
            });

            // Prevenir scroll en modal
            document.addEventListener('touchmove', (e) => {
                if (document.querySelector('.modal.is-visible')) {
                    e.preventDefault();
                }
            }, { passive: false });

            // Suscripción en tiempo real
            supabaseClient
                .channel('public:links')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'links' }, 
                (payload) => {
                    console.log('Change received!', payload);
                    if (document.visibilityState === 'visible') {
                        fetchLinks();
                    }
                })
                .subscribe();
        });
    </script>
</body>
</html>
